<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-ar.min.js"></script>
    <script src="https://rawgit.com/jeromeetienne/AR.js/1.7.2/aframe/build/aframe-gps-component.min.js"></script>
</head>
<body style="margin: 0; overflow: hidden; text-align: center;">

    <!-- ลูกศรนำทาง -->
    <div id="arrowContainer" style="
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80px;
        height: 80px;
    ">
        <img id="arrowIcon" src="https://cdn-icons-png.flaticon.com/512/271/271228.png" 
             style="width: 100%; height: 100%; transform: rotate(0deg);">
    </div>

    <a-scene embedded arjs gps-camera="minDistance: 0; maxDistance: 1000;">
        <!-- โมเดล 3D ที่พิกัด GPS -->
        <a-box id="targetModel"
               gps-entity-place="latitude: 14.799428047423824; longitude: 100.6228983236227"
               material="color: red; opacity: 0.7" scale="5 5 5"></a-box>
    </a-scene>

    <script>
        let userLat, userLon;  // พิกัดของผู้ใช้
        const targetLat = 14.799428047423824;  // พิกัดโมเดล
        const targetLon = 100.6228983236227;
        const arrowIcon = document.getElementById("arrowIcon");

        // ฟังก์ชันคำนวณทิศทาง (Bearing)
        function calculateBearing(lat1, lon1, lat2, lon2) {
            let dLon = (lon2 - lon1) * Math.PI / 180;
            let y = Math.sin(dLon) * Math.cos(lat2 * Math.PI / 180);
            let x = Math.cos(lat1 * Math.PI / 180) * Math.sin(lat2 * Math.PI / 180) -
                    Math.sin(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.cos(dLon);
            let brng = Math.atan2(y, x) * 180 / Math.PI;
            return (brng + 360) % 360;  // แปลงเป็นองศา (0-360)
        }

        // ฟังก์ชันอัปเดตตำแหน่งผู้ใช้
        function updateUserLocation(position) {
            userLat = position.coords.latitude;
            userLon = position.coords.longitude;
            updateArrowDirection();
        }

        // ฟังก์ชันหมุนลูกศรไปตามทิศทางของโมเดล
        function updateArrowDirection() {
            if (!userLat || !userLon) return;
            
            const bearing = calculateBearing(userLat, userLon, targetLat, targetLon);
            arrowIcon.style.transform = `rotate(${bearing}deg)`;
        }

        // ตรวจจับ GPS ของผู้ใช้
        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(updateUserLocation, 
                error => console.log("⛔ เปิด GPS และโหลดใหม่!"),
                { enableHighAccuracy: true }
            );
        } else {
            console.log("⛔ อุปกรณ์นี้ไม่รองรับ GPS!");
        }
    </script>

</body>
</html>
